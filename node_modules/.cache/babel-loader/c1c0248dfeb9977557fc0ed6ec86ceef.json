{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/DELL/Documents/celowear/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/DELL/Documents/celowear/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/DELL/Documents/celowear/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Fragment}from\"react\";import AddCloth from\"./AddCloth\";import Header from\"./Header\";import Shop from\"./Shop\";import Web3 from\"web3\";import{newKitFromWeb3}from\"@celo/contractkit\";import BigNumber from\"bignumber.js\";import wear from\"./contracts/wear.abi.json\";import erc20 from\"./contracts/IERC.abi.json\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ERC20_DECIMALS=18;var contractAddress=\"0x46178FeB4e08589978a0e1c440fBB0A0A8EB2A64\";var cUSDContractAddress=\"0x874069Fa1Eb16D44d622F2e0Ca25eeA172369bC1\";function App(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),contract=_useState2[0],setcontract=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),address=_useState4[0],setAddress=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),kit=_useState6[0],setKit=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),cUSDBalance=_useState8[0],setcUSDBalance=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),clothes=_useState10[0],setClothes=_useState10[1];var connectCeloWallet=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var web3,_kit,accounts,user_address;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!window.celo){_context.next=23;break;}_context.prev=1;_context.next=4;return window.celo.enable();case 4:// notificationOff()\nweb3=new Web3(window.celo);_kit=newKitFromWeb3(web3);_context.next=8;return _kit.web3.eth.getAccounts();case 8:accounts=_context.sent;user_address=accounts[0];_kit.defaultAccount=user_address;_context.next=13;return setAddress(user_address);case 13:_context.next=15;return setKit(_kit);case 15:_context.next=21;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](1);console.log(\"There is an error\");console.log({error:_context.t0});// notification(`⚠️ ${error}.`)\ncase 21:_context.next=24;break;case 23:console.log(\"please install the extension\");// notification(\"⚠️ Please install the CeloExtensionWallet.\")\ncase 24:case\"end\":return _context.stop();}}},_callee,null,[[1,17]]);}));return function connectCeloWallet(){return _ref.apply(this,arguments);};}();var getBalance=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var balance,USDBalance,contract;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return kit.getTotalBalance(address);case 2:balance=_context2.sent;USDBalance=balance.cUSD.shiftedBy(-ERC20_DECIMALS).toFixed(2);contract=new kit.web3.eth.Contract(wear,contractAddress);setcontract(contract);setcUSDBalance(USDBalance);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function getBalance(){return _ref2.apply(this,arguments);};}();useEffect(function(){connectCeloWallet();},[]);useEffect(function(){if(kit&&address){return getBalance();}else{console.log(\"no kit or address\");}},[kit,address]);useEffect(function(){if(contract){getClothes();}},[contract]);var getClothes=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var clothLength,_cloths,_loop,index,cloths;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return contract.methods.getClothLength().call();case 2:clothLength=_context4.sent;_cloths=[];_loop=function _loop(index){var _cloth=new Promise(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(resolve,reject){var c;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return contract.methods.getCloth(index).call();case 2:c=_context3.sent;resolve({index:index,owner:c[0],name:c[1],description:c[2],image:c[3],price:c[4],isUsed:c[5]});case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x,_x2){return _ref4.apply(this,arguments);};}());_cloths.push(_cloth);};for(index=0;index<clothLength;index++){_loop(index);}_context4.next=8;return Promise.all(_cloths);case 8:cloths=_context4.sent;setClothes(cloths);case 10:case\"end\":return _context4.stop();}}},_callee4);}));return function getClothes(){return _ref3.apply(this,arguments);};}();var buyCloth=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_index,_price){var cUSDContract,cost;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;cUSDContract=new kit.web3.eth.Contract(erc20,cUSDContractAddress);cost=new BigNumber(_price).shiftedBy(ERC20_DECIMALS).toString();_context5.next=5;return cUSDContract.methods.approve(contractAddress,cost).send({from:address});case 5:_context5.next=7;return contract.methods.buyCloth(_index).send({from:address});case 7:// return result\ngetBalance();getClothes();_context5.next=14;break;case 11:_context5.prev=11;_context5.t0=_context5[\"catch\"](0);console.log({error:_context5.t0});case 14:case\"end\":return _context5.stop();}}},_callee5,null,[[0,11]]);}));return function buyCloth(_x3,_x4){return _ref5.apply(this,arguments);};}();var addCloth=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(_name,_description,_image,_price,_isUsed){var price;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;price=new BigNumber(_price).shiftedBy(ERC20_DECIMALS).toString();_context6.next=4;return contract.methods.addCloth(_name,_description,_image,price,_isUsed).send({from:address});case 4:getClothes();_context6.next=10;break;case 7:_context6.prev=7;_context6.t0=_context6[\"catch\"](0);console.log(_context6.t0);case 10:case\"end\":return _context6.stop();}}},_callee6,null,[[0,7]]);}));return function addCloth(_x5,_x6,_x7,_x8,_x9){return _ref6.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(Header,{balance:cUSDBalance}),/*#__PURE__*/_jsx(Shop,{clothes:clothes,buyCloth:buyCloth}),/*#__PURE__*/_jsx(AddCloth,{addCloth:addCloth})]});}export default App;","map":{"version":3,"sources":["C:/Users/DELL/Documents/celowear/src/App.js"],"names":["React","useState","useEffect","Fragment","AddCloth","Header","Shop","Web3","newKitFromWeb3","BigNumber","wear","erc20","ERC20_DECIMALS","contractAddress","cUSDContractAddress","App","contract","setcontract","address","setAddress","kit","setKit","cUSDBalance","setcUSDBalance","clothes","setClothes","connectCeloWallet","window","celo","enable","web3","eth","getAccounts","accounts","user_address","defaultAccount","console","log","error","getBalance","getTotalBalance","balance","USDBalance","cUSD","shiftedBy","toFixed","Contract","getClothes","methods","getClothLength","call","clothLength","_cloths","index","_cloth","Promise","resolve","reject","getCloth","c","owner","name","description","image","price","isUsed","push","all","cloths","buyCloth","_index","_price","cUSDContract","cost","toString","approve","send","from","addCloth","_name","_description","_image","_isUsed"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Fragment } from \"react\";\nimport AddCloth from \"./AddCloth\";\nimport Header from \"./Header\";\nimport Shop from \"./Shop\";\n\nimport Web3 from \"web3\";\nimport { newKitFromWeb3 } from \"@celo/contractkit\";\nimport BigNumber from \"bignumber.js\";\n\nimport wear from \"./contracts/wear.abi.json\";\nimport erc20 from \"./contracts/IERC.abi.json\";\n\nconst ERC20_DECIMALS = 18;\n\nconst contractAddress = \"0x46178FeB4e08589978a0e1c440fBB0A0A8EB2A64\";\nconst cUSDContractAddress = \"0x874069Fa1Eb16D44d622F2e0Ca25eeA172369bC1\";\n\nfunction App() {\n  const [contract, setcontract] = useState(null);\n  const [address, setAddress] = useState(null);\n  const [kit, setKit] = useState(null);\n  const [cUSDBalance, setcUSDBalance] = useState(0);\n  const [clothes, setClothes] = useState([])\n\n  const connectCeloWallet = async () => {\n    if (window.celo) {\n      // notification(\"⚠️ Please approve this DApp to use it.\")\n      try {\n        await window.celo.enable();\n        // notificationOff()\n        const web3 = new Web3(window.celo);\n        let kit = newKitFromWeb3(web3);\n\n        const accounts = await kit.web3.eth.getAccounts();\n        const user_address = accounts[0];\n\n        kit.defaultAccount = user_address;\n\n        await setAddress(user_address);\n\n        await setKit(kit);\n      } catch (error) {\n        console.log(\"There is an error\");\n        console.log({ error });\n        // notification(`⚠️ ${error}.`)\n      }\n    } else {\n      console.log(\"please install the extension\");\n      // notification(\"⚠️ Please install the CeloExtensionWallet.\")\n    }\n  };\n\n  const getBalance = async () => {\n    const balance = await kit.getTotalBalance(address);\n    const USDBalance = balance.cUSD.shiftedBy(-ERC20_DECIMALS).toFixed(2);\n\n    const contract = new kit.web3.eth.Contract(wear, contractAddress);\n    setcontract(contract);\n    setcUSDBalance(USDBalance);\n  };\n\n  useEffect(() => {\n    connectCeloWallet();\n  }, []);\n\n  useEffect(() => {\n    if (kit && address) {\n      return getBalance();\n    } else {\n      console.log(\"no kit or address\");\n    }\n  }, [kit, address]);\n\n  useEffect(() => {\n    if (contract) {\n      getClothes();\n    }\n  }, [contract]);\n\n\n  const getClothes = async function () {\n    const clothLength = await contract.methods.getClothLength().call();\n    const _cloths = [];\n\n    for (let index = 0; index < clothLength; index++) {\n      let _cloth = new Promise(async (resolve, reject) => {\n        let c = await contract.methods.getCloth(index).call();\n        resolve({\n          index: index,\n          owner: c[0],\n          name: c[1],\n          description: c[2],\n          image: c[3],\n          price: c[4],\n          isUsed: c[5],\n        });\n      });\n\n      _cloths.push(_cloth);\n    }\n    const cloths = await Promise.all(_cloths);\n\n    setClothes(cloths);\n\n  };\n\n  const buyCloth = async (_index, _price)=>{\n    try {\n      const cUSDContract = new kit.web3.eth.Contract(erc20, cUSDContractAddress);\n      const cost = new BigNumber(_price).shiftedBy(ERC20_DECIMALS).toString();\n\n      await cUSDContract.methods\n        .approve(contractAddress, cost)\n        .send({ from: address });\n\n      await contract.methods.buyCloth(_index).send({ from: address });\n      // return result\n      getBalance();\n      getClothes();\n    } catch (error) {\n      console.log({ error });\n    }\n  }\n  const addCloth = async (_name, _description, _image, _price, _isUsed) => {\n    try {\n      const price = new BigNumber(_price)\n        .shiftedBy(ERC20_DECIMALS).toString();\n\n\n      await contract.methods\n        .addCloth(\n          _name,\n          _description,\n          _image,\n          price,\n          _isUsed, \n          \n        )\n        .send({ from: address });\n      getClothes();\n    } catch (error) {\n      console.log(error);\n    }\n\n  }\n  return (\n    <Fragment>\n      <Header balance={cUSDBalance} />\n      <Shop clothes = {clothes} buyCloth = {buyCloth}/>\n      <AddCloth addCloth = {addCloth}/>\n    </Fragment>\n  );\n}\n\n\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}